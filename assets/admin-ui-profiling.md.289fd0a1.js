import{_ as a,a as t,b as e,c as p,d as o,e as c,f as i,g as l,h as u,i as r,j as k,k as d,l as m,m as g,n as f,o as h,p as v,q as y,r as w,s as b,t as q,u as R}from"./chunks/profiling-custom-meta.9fa1e4fd.js";import{_ as D,c as E,o as L,b as n,e as s,a as T}from"./app.017cb202.js";const U='{"title":"Logging & Profiling UI","description":"","frontmatter":{"title":"Logging & Profiling UI"},"headers":[{"level":3,"title":"Configuration","slug":"configuration"},{"level":3,"title":"Request Logging UI","slug":"request-logging-ui"},{"level":2,"title":"Profiling UI","slug":"profiling-ui"},{"level":3,"title":"SQL Profiling","slug":"sql-profiling"},{"level":3,"title":"Redis Profiling","slug":"redis-profiling"},{"level":3,"title":"Purchase API Events Example","slug":"purchase-api-events-example"},{"level":3,"title":"HttpClient Profiling","slug":"httpclient-profiling"},{"level":3,"title":"JsonApiClient Profiling","slug":"jsonapiclient-profiling"},{"level":3,"title":"MQ Profiling","slug":"mq-profiling"},{"level":3,"title":"Service Gateway Profiling","slug":"service-gateway-profiling"},{"level":3,"title":"Profile Custom Info","slug":"profile-custom-info"},{"level":3,"title":"Profile Custom Metadata","slug":"profile-custom-metadata"},{"level":3,"title":"Access Diagnostic Events in Code","slug":"access-diagnostic-events-in-code"},{"level":3,"title":"Request Logs Configuration","slug":"request-logs-configuration"},{"level":3,"title":"Profiling Configuration","slug":"profiling-configuration"}],"relativePath":"admin-ui-profiling.md"}',O={},C=n("p",null,[s("The Request Logging & Profiling UIs bring an invaluable new level of observability into your App, from being able to quickly inspect and browse incoming requests, to tracing their behavior from their generated events in the "),n("a",{href:"https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.diagnosticsource?view=net-6.0",target:"_blank",rel:"noopener noreferrer"},"Diagnostic Source"),s(" capabilities added all throughout ServiceStack, which both power the new UIs and enables new introspectability from code where you can now to tap in to inspect & debug when each diagnostic event occurs.")],-1),x=n("iframe",{class:"video-hd",src:"https://www.youtube.com/embed/LgQHTSHSk1g",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),P=n("p",null,[s("The quickest way to enable access to these new features is to "),n("a",{href:"/mix-tool"},"mix"),s(" in the profiling configuration:")],-1),S=n("div",{class:"sh-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[n("div",{class:"flex-grow bg-gray-800"},[n("div",{class:"pl-4 py-1 pb-1.5 align-middle whitespace-pre text-base text-gray-100"},[n("p",null,"x mix profiling")])]),n("div",{class:"flex"},[n("div",{class:"bg-green-600 text-white p-1.5 pb-0"},[n("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),n("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),A=T(`<p>Which will add the <a href="/modular-startup">Modular Startup</a> configuration to your Host project that registers both Request Logging &amp; Profiling features when running your App in <a href="/debugging#debugmode">DebugMode</a> (i.e. Development):</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureProfiling</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHostingStartup</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IWebHostBuilder</span> builder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">ConfigureAppHost</span><span class="token punctuation">(</span>host <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            host<span class="token punctuation">.</span>Plugins<span class="token punctuation">.</span><span class="token function">AddIfDebug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RequestLogsFeature</span> <span class="token punctuation">{</span>
                EnableResponseTracking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            host<span class="token punctuation">.</span>Plugins<span class="token punctuation">.</span><span class="token function">AddIfDebug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProfilingFeature</span> <span class="token punctuation">{</span>
                IncludeStackTrace <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The default configuration looks at providing useful information during development, where the response request bodies are captured in the Request Logger and the StackTrace is captured on the important events where they can be useful.</p><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-hidden="true">#</a></h3><p>Depending on your App you&#39;ll want to change these defaults, e.g. if you&#39;re persisting the request logs using the <a href="/request-logger#csv-request-logger">CSV Request Logger</a> or <a href="/request-logger#redis-request-logger">Redis Request Logger</a> it may not be feasible to <strong>capture all API responses</strong> if they&#39;re very large.</p><p>If enabled, <strong>StackTraces</strong> are captured in these important events:</p><ul><li><strong>ServiceStack:</strong> Before a Service Gateway Request is sent</li><li><strong>OrmLite:</strong> Opening a connection or rolling back a transaction</li><li><strong>Redis:</strong> Opening a connection, auto retrying a failed command, renting &amp; returning clients from a redis manager pool</li></ul><p>The latter of which is useful when resolving <a href="/redis/troubleshooting">concurrent usage issues</a>.</p><p>As it adds overhead, profiling should only be added when used, e.g. during development or when needing to debug production issues. Although you may always want to capture request logs depending on how important it is to maintain an audit of completed API requests. Should it be needed, both Logging &amp; Profiling plugins offer several configuration options to control the type, info &amp; events captured.</p><p>Whichever features you have registered will dynamically appear in the Admin UI&#39;s sidebar for quick navigation:</p><p><img src="`+a+'" alt=""></p><h3 id="request-logging-ui" tabindex="-1">Request Logging UI <a class="header-anchor" href="#request-logging-ui" aria-hidden="true">#</a></h3><p>Clicking on <strong>Logging</strong> navigates to the Request Logging UI which displays each API request processed in a grid of useful summary information showing high-level information for each HTTP API request:</p><p><img src="'+t+'" alt=""></p><p>This screenshot shows an example of a non-authenticated user navigating to a protected page before signing in then querying and submitting a new Booking in the <a href="/autoquery-crud-bookings">AutoQuery CRUD Bookings Demo</a> using <a href="/locode/">Locode&#39;s</a> Auto UI, in which we can see error API Responses are highlighted in <strong>red</strong> and redirects highlighted in <strong>yellow</strong>.</p><p>The top navigation controls which results are displayed with:</p><ul><li><strong>Has Errors</strong> - Show only requests with errors</li><li><strong>Has Response</strong> - Show only requests with response bodies</li><li><strong>Reset Filters Icon</strong> - Clear all filters (ESC)</li><li><strong>Left/Right Icons</strong> - Navigate to previous/next pages (LEFT/RIGHT)</li><li><strong>Refresh Icon</strong> - Reload the latest results</li></ul><p>This same user workflow is also captured in the Profiling UI in much finer granularity, capturing all the events performed by APIs:</p><p><img src="'+e+'" alt=""></p><p>Clicking on an entry previews it in more detail, e.g. clicking on the first <strong>/api/QueryBookings</strong> will show the API Request and Response made:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+p+'"></div><p>By default it shows the Request and Response DTOs in JSON, but clicking on preview often shows a more human-friendly view:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+o+'"></div><p>A useful feature from having a dedicated UX-friendly UI is enabling quick navigation where each <strong>blue</strong> link will display results filtered to all matching requests, whilst the <strong>trace request</strong> link will navigate to the Profiling UI showing all diagnostic events performed within that request.</p><p>In addition to Request &amp; Response DTOs, the Logging UI also shows all captured HTTP information including HTTP Request Headers with any Cookies being extracted into its own view for better readability as well as decoded JWT payload from the <strong>ss-tok</strong> cookie when using <a href="/jwt-authprovider">JWT Auth</a> with non-encrypted JWT defaults.</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+c+'"></div><p>Lets now take a look at the failed <strong>CreateBooking</strong> request to see what went wrong:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+i+'"></div><p>Ok, so the Admin User (identified from JWT info) tried to create an empty booking which was rejected by its server declarative validation rules which sees these context validation errors surfaced into Locode&#39;s UI:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+l+'"></div><p>We can then see this was quickly rectified in the next request with a successful Booking submitted:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+u+'"></div><p>Clicking on <strong>trace request</strong> we can see all the diagnostic events performed in this API request within the <strong>RequestBefore</strong> and <strong>RequestAfter</strong> events which took <strong>0.07s</strong> to complete.</p><h2 id="profiling-ui" tabindex="-1">Profiling UI <a class="header-anchor" href="#profiling-ui" aria-hidden="true">#</a></h2><p>Following diagnostic conventions you&#39;ll typically see 2 entries for each event, created before and after each action, measuring the duration and capturing the last event before any error occurred.</p><p><img src="'+r+'" alt=""></p><h3 id="sql-profiling" tabindex="-1">SQL Profiling <a class="header-anchor" href="#sql-profiling" aria-hidden="true">#</a></h3><p>Clicking on an entry will show more useful contextual information captured for each event, e.g. if you click on OrmLite&#39;s <strong>CommandAfter</strong> event you&#39;ll be able to see the generated SQL + Params executed by OrmLite:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+k+'"></div><p>The profiling detail view also contains <strong>blue</strong> links to filter matching diagnostic events and showing useful information like the <strong>Thread</strong>, <strong>User</strong> this command was executed by as well as the <strong>duration</strong> and <strong>timestamp</strong> when it occurred.</p><h3 id="redis-profiling" tabindex="-1">Redis Profiling <a class="header-anchor" href="#redis-profiling" aria-hidden="true">#</a></h3><p>Redis simpler commands are captured in a list of arguments:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+d+'"></div><h3 id="purchase-api-events-example" tabindex="-1">Purchase API Events Example <a class="header-anchor" href="#purchase-api-events-example" aria-hidden="true">#</a></h3><p>Surfacing the high-level events of your service implementations provides a new observability perspective that&#39;s harder to infer from trying to follow the details in the code.</p><p>For example our <a href="https://account.servicestack.net/buy/BUS" target="_blank" rel="noopener noreferrer">Order Page</a> generated over <strong>150+ events</strong> capturing all the SQL commands to store order, subscription, customer, payment information and generated License and Order confirmation emails, HttpClient integration requests with Stripe and MQ requests for sending emails in a <a href="/background-mq">Background MQ Worker thread</a>.</p><p><img src="'+m+'" alt=""></p><h3 id="httpclient-profiling" tabindex="-1">HttpClient Profiling <a class="header-anchor" href="#httpclient-profiling" aria-hidden="true">#</a></h3><p>HttpClient profiling is implemented a little differently then other events in that it builds on the existing HttpClient diagnostic events so it&#39;s able to capture general usage of .NET&#39;s HttpClient, which is how it&#39;s able to capture our <a href="/stripe">integration with Stripe</a>:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+g+'"></div><h3 id="jsonapiclient-profiling" tabindex="-1">JsonApiClient Profiling <a class="header-anchor" href="#jsonapiclient-profiling" aria-hidden="true">#</a></h3><p>Although we&#39;re able to provide richer profiling for our .NET 6+ <a href="/csharp-client#jsonapiclient">JsonApiClient</a> which has access to typed Request DTOs for submitting API Requests:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+f+'"></div><p>As well as Response DTOs returned in API Responses:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+h+'"></div><p>We also can examine API Error responses in richer detail, e.g:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+v+'"></div><h3 id="mq-profiling" tabindex="-1">MQ Profiling <a class="header-anchor" href="#mq-profiling" aria-hidden="true">#</a></h3><p>Since they execute APIs on an entirely different endpoint and worker threads, MQ Requests are tracked independently from HTTP APIs starting their own diagnostic Activity which enables being able to trace all events generated from an MQ Request. Here&#39;s an example used to handle sending customer emails:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+y+'"></div><h3 id="service-gateway-profiling" tabindex="-1">Service Gateway Profiling <a class="header-anchor" href="#service-gateway-profiling" aria-hidden="true">#</a></h3><p>The <a href="/service-gateway">Service Gateway</a> leverages ServiceStack&#39;s message-based design to enable loosely-coupled service integrations enabling systems to split into Microservices without needing to change any of the internal services consuming them. As they&#39;re not RPC invocations their messages are introspectable and can be observed in the Profiling UI:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+w+`"></div><h3 id="profile-custom-info" tabindex="-1">Profile Custom Info <a class="header-anchor" href="#profile-custom-info" aria-hidden="true">#</a></h3><p>We&#39;ve made it easy to add a custom tracking field with the same functionality as the primary fields where they can be sorted and filtered. This could be used to attach a <strong>Tenant Id</strong> to the profiling information by providing a Label and Resolver function to resolve it, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProfilingFeature</span> <span class="token punctuation">{</span>
    TagLabel <span class="token operator">=</span> <span class="token string">&quot;Tenant&quot;</span><span class="token punctuation">,</span>
    TagResolver <span class="token operator">=</span> req <span class="token operator">=&gt;</span> <span class="token function">MyResolveTenant</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where it will be displayed in all profiling results, e.g:</p><p><img src="`+b+'" alt=""></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The number and order of fields can be customized in <code>SummaryFields</code> collection in <code>ProfilingFeature</code></p></div><p>This custom info also appears in the detail page as a link which can be used to filter events with the same tenant id:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="'+q+`"></div><h3 id="profile-custom-metadata" tabindex="-1">Profile Custom Metadata <a class="header-anchor" href="#profile-custom-metadata" aria-hidden="true">#</a></h3><p>You&#39;re also able to capture custom information for different events and have them appear in the detail page, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProfilingFeature</span> <span class="token punctuation">{</span>
    DiagnosticEntryFilter <span class="token operator">=</span> <span class="token punctuation">(</span>entry<span class="token punctuation">,</span> evt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evt <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> requestEvent<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> req <span class="token operator">=</span> requestEvent<span class="token punctuation">.</span>Request<span class="token punctuation">;</span>
            entry<span class="token punctuation">.</span>Meta <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">[</span><span class="token string">&quot;RemoteIp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>RemoteIp<span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;Referrer&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>UrlReferrer<span class="token punctuation">?.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">&quot;Language&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">GetHeader</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>AcceptLanguage<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where it will be populated in the <strong>Meta</strong> section arguments:</p><div class="block flex justify-center items-center"><img class="max-w-screen-md" src="`+R+`"></div><h3 id="access-diagnostic-events-in-code" tabindex="-1">Access Diagnostic Events in Code <a class="header-anchor" href="#access-diagnostic-events-in-code" aria-hidden="true">#</a></h3><p>In addition to powering the profiling UI, the diagnostic events added throughout ServiceStack can be observed in code to tap in and inspect when these diagnostic events occur. It follows the standard Diagnostic Source model where you specify which listeners you want observed in <code>OnNext(DiagnosticListener)</code> that you can then access in <code>OnNext(KeyValuePair&lt;string,object&gt;)</code>.</p><p>Microsoft&#39;s Diagnostic Events like HttpClient uses anonymous classes making them unnecessarily difficult to access, which can be made easier by using our <a href="/reflection-utils#converting-instances-from-an-object-dictionary">Reflection Utils ToObjectDictionary()</a>.</p><p>As they offer better utility, we&#39;ve opted to use idiomatic strong types and string constants instead where they&#39;re better accessible from C#.</p><p>You can use this skeleton class for a quick way to get started showing how to subscribe to all ServiceStack Diagnostic Sources and the event names and types to handle all profiling events:</p><div class="language-csharp"><pre><code><span class="token comment">// Register your Diagnostic Observer</span>
<span class="token class-name"><span class="token keyword">var</span></span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDiagnosticObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> subscription <span class="token operator">=</span> DiagnosticListener<span class="token punctuation">.</span>AllListeners<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">MyDiagnosticObserver</span> <span class="token punctuation">:</span> 
    <span class="token type-list"><span class="token class-name">IObserver<span class="token punctuation">&lt;</span>DiagnosticListener<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> 
    <span class="token class-name">IObserver<span class="token punctuation">&lt;</span>KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>IDisposable<span class="token punctuation">&gt;</span></span> subscriptions <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Specify which Profiling Events you want to observe */</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> IObserver<span class="token operator">&lt;</span>DiagnosticListener<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">OnNext</span><span class="token punctuation">(</span><span class="token class-name">DiagnosticListener</span> diagnosticListener<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>diagnosticListener<span class="token punctuation">.</span>Name <span class="token keyword">is</span> <span class="token class-name">Diagnostics<span class="token punctuation">.</span>Listeners<span class="token punctuation">.</span>ServiceStack</span>         
         <span class="token operator">||</span> diagnosticListener<span class="token punctuation">.</span>Name <span class="token keyword">is</span> <span class="token class-name">Diagnostics<span class="token punctuation">.</span>Listeners<span class="token punctuation">.</span>OrmLite</span>
         <span class="token operator">||</span> diagnosticListener<span class="token punctuation">.</span>Name <span class="token keyword">is</span> <span class="token class-name">Diagnostics<span class="token punctuation">.</span>Listeners<span class="token punctuation">.</span>Redis</span>
         <span class="token operator">||</span> diagnosticListener<span class="token punctuation">.</span>Name <span class="token keyword">is</span> <span class="token class-name">Diagnostics<span class="token punctuation">.</span>Listeners<span class="token punctuation">.</span>Client</span>
         <span class="token operator">||</span> diagnosticListener<span class="token punctuation">.</span>Name <span class="token keyword">is</span> <span class="token class-name">Diagnostics<span class="token punctuation">.</span>Listeners<span class="token punctuation">.</span>HttpClient</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> subscription <span class="token operator">=</span> diagnosticListener<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            subscriptions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>subscription<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Handle Profiling Events */</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnNext</span><span class="token punctuation">(</span><span class="token class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> kvp<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/** ServiceStack */</span>
        <span class="token comment">/*** Request */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteRequestBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> reqBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteRequestAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> reqAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteRequestError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> reqError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        
        <span class="token comment">/*** Gateway */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteGatewayBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> gatewayBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteGatewayAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> gatewayAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteGatewayError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RequestDiagnosticEvent</span> gatewayError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        
        <span class="token comment">/*** MQ */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteMqRequestBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">MqRequestDiagnosticEvent</span> mqReqBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteMqRequestAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">MqRequestDiagnosticEvent</span> mqReqAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteMqRequestError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">MqRequestDiagnosticEvent</span> mqReqError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>ServiceStack<span class="token punctuation">.</span>WriteMqRequestPublish <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">MqRequestDiagnosticEvent</span> mqReqPublish<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        
        <span class="token comment">/** Client */</span>    
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>WriteRequestBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">HttpClientDiagnosticEvent</span> clientBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>WriteRequestAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">HttpClientDiagnosticEvent</span> clientAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Client<span class="token punctuation">.</span>WriteRequestError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">HttpClientDiagnosticEvent</span> clientError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        
        <span class="token comment">/** HttpClient */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span>OutStart<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToObjectDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span>Request<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToObjectDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span>OutStop<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
             <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToObjectDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>HttpClient<span class="token punctuation">.</span>Response<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> obj <span class="token operator">=</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToObjectDictionary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/** OrmLite */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteCommandBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteCommandAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteCommandError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        
        <span class="token comment">/*** OrmLite Connections */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionOpenBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbOpenBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionOpenAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbOpenAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionOpenError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbOpenError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionCloseBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbCloseBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionCloseAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbCloseAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteConnectionCloseError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> dbCloseError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>        
        
        <span class="token comment">/*** OrmLite Transactions */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionOpen <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> commitOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionCommitBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> commitBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionCommitAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> commitAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionCommitError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> commitError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionRollbackBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> rollbackBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionRollbackAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> rollbackAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>OrmLite<span class="token punctuation">.</span>WriteTransactionRollbackError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">OrmLiteDiagnosticEvent</span> rollbackError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>

        <span class="token comment">/** Redis */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteCommandBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteCommandRetry <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisRetry<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteCommandAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteCommandError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>        
        
        <span class="token comment">/*** Redis Connections */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionOpenBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisOpenBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionOpenAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisOpenAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionOpenError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisOpenError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionCloseBefore <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisCloseBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionCloseAfter <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisCloseAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WriteConnectionCloseError <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisCloseError<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>        
        
        <span class="token comment">/*** Redis Pools */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WritePoolRent <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisPoolBefore<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>kvp<span class="token punctuation">.</span>Key <span class="token operator">==</span> Diagnostics<span class="token punctuation">.</span>Events<span class="token punctuation">.</span>Redis<span class="token punctuation">.</span>WritePoolReturn <span class="token operator">&amp;&amp;</span> kvp<span class="token punctuation">.</span>Value <span class="token keyword">is</span> <span class="token class-name">RedisDiagnosticEvent</span> redisPoolAfter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> IObserver<span class="token operator">&lt;</span>DiagnosticListener<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">OnCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        subscriptions<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subscriptions<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> IObserver<span class="token operator">&lt;</span>DiagnosticListener<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">OnError</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnError</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="request-logs-configuration" tabindex="-1">Request Logs Configuration <a class="header-anchor" href="#request-logs-configuration" aria-hidden="true">#</a></h3><p>The <a href="/request-logger">Request Logs</a> feature has a number of configuration options controlling which requests are logged and the level of logging captured about them.</p><div class="language-csharp"><pre><code><span class="token keyword">class</span> <span class="token class-name">RequestLogsFeature</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// Limit API access to users in role</span>
    <span class="token class-name"><span class="token keyword">string</span></span> AccessRole <span class="token operator">=</span> RoleNames<span class="token punctuation">.</span>Admin<span class="token punctuation">;</span>

    <span class="token comment">// RequestLogs service Route, default is /requestlogs</span>
    <span class="token class-name"><span class="token keyword">string</span></span> AtRestPath <span class="token operator">=</span> <span class="token string">&quot;/requestlogs&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Size of memory logger circular buffer</span>
    <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Capacity<span class="token punctuation">;</span>

    <span class="token comment">// Turn On/Off Session Tracking</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> EnableSessionTracking<span class="token punctuation">;</span>

    <span class="token comment">// Turn On/Off Logging of Raw Request Body, default is Off</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> EnableRequestBodyTracking<span class="token punctuation">;</span>

    <span class="token comment">// Turn On/Off Raw Request Body Tracking per-request</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> RequestBodyTrackingFilter<span class="token punctuation">;</span>

    <span class="token comment">// Turn On/Off Tracking of Responses</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> EnableResponseTracking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// Turn On/Off Tracking of Responses per-request</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> ResponseTrackingFilter<span class="token punctuation">;</span>
    
    <span class="token comment">// Turn On/Off Tracking of Exceptions</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> EnableErrorTracking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log matching requests</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> SkipLogging<span class="token punctuation">;</span>

    <span class="token comment">// Change the RequestLogger provider. Default is InMemoryRollingRequestLogger</span>
    <span class="token class-name">IRequestLogger</span> RequestLogger<span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log requests of these types. By default RequestLog&#39;s are excluded</span>
    <span class="token class-name">Type<span class="token punctuation">[</span><span class="token punctuation">]</span></span> ExcludeRequestDtoTypes<span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log request body&#39;s for services with sensitive information.</span>
    <span class="token comment">// By default Auth and Registration requests are hidden.</span>
    <span class="token class-name">Type<span class="token punctuation">[</span><span class="token punctuation">]</span></span> HideRequestBodyForRequestDtoTypes<span class="token punctuation">;</span>
    
    <span class="token comment">// Don&#39;t log Response DTO Types</span>
    <span class="token class-name">Type<span class="token punctuation">[</span><span class="token punctuation">]</span></span> ExcludeResponseTypes<span class="token punctuation">;</span>

    <span class="token comment">// Limit logging to only Service Requests</span>
    <span class="token class-name"><span class="token keyword">bool</span></span> LimitToServiceRequests <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Customize Request Log Entry</span>
    <span class="token class-name">Action<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> RequestLogEntry<span class="token punctuation">&gt;</span></span> RequestLogFilter<span class="token punctuation">;</span>

    <span class="token comment">// Ignore logging and serializing these Request DTOs</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Type<span class="token punctuation">&gt;</span></span> IgnoreTypes<span class="token punctuation">;</span> <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Use custom Ignore Request DTO predicate</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> IgnoreFilter <span class="token operator">=</span> DefaultIgnoreFilter<span class="token punctuation">;</span>

    <span class="token comment">// Default take, if none is specified</span>
    <span class="token class-name"><span class="token keyword">int</span></span> DefaultLimit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token comment">// Change what DateTime to use for the current Date (defaults to UtcNow)</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span> CurrentDateFn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="profiling-configuration" tabindex="-1">Profiling Configuration <a class="header-anchor" href="#profiling-configuration" aria-hidden="true">#</a></h3><p>The <code>ProfilingFeature</code> offers similar functionality in specifying which sources to observe and profiling events to capture as well as options for customizing the Profiling UI, e.g you can limit generating &amp; capturing diagnostic events to just <a href="/ormlite/">OrmLite</a> and <a href="/redis/">Redis</a> with:</p><div class="language-csharp"><pre><code>Plugins<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProfilingFeature</span> <span class="token punctuation">{</span>
    Profile <span class="token operator">=</span> ProfileSource<span class="token punctuation">.</span>OrmLite <span class="token operator">|</span> ProfileSource<span class="token punctuation">.</span>Redis
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>For further configuration options see the documented plugin below:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span>
<span class="token keyword">enum</span> <span class="token class-name">ProfileSource</span>
<span class="token punctuation">{</span>
    None         <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ServiceStack <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
    Client       <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    Redis        <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
    OrmLite      <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
    All          <span class="token operator">=</span> ServiceStack <span class="token operator">|</span> Client <span class="token operator">|</span> OrmLite <span class="token operator">|</span> Redis<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ProfilingFeature</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Limit API access to users in role</span>
    <span class="token class-name"><span class="token keyword">string</span></span> AccessRole <span class="token operator">=</span> RoleNames<span class="token punctuation">.</span>Admin<span class="token punctuation">;</span>

    <span class="token comment">// Which features to Profile, default all</span>
    <span class="token class-name">ProfileSource</span> Profile <span class="token operator">=</span> ProfileSource<span class="token punctuation">.</span>All<span class="token punctuation">;</span>

    <span class="token comment">// Size of circular buffer of profiled events</span>
    <span class="token class-name"><span class="token keyword">int</span></span> Capacity <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log requests of these types. By default Profiling/Metadata requests are excluded</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Type<span class="token punctuation">&gt;</span></span> ExcludeRequestDtoTypes <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log requests from these path infos prefixes</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> ExcludeRequestPathInfoStartingWith <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Turn On/Off Tracking of Responses per-request</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> ExcludeRequestsFilter<span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log request body&#39;s for services with sensitive information.</span>
    <span class="token comment">// By default Auth and Registration requests are hidden.</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Type<span class="token punctuation">&gt;</span></span> HideRequestBodyForRequestDtoTypes <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Don&#39;t log Response DTO Types</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Type<span class="token punctuation">&gt;</span></span> ExcludeResponseTypes <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Turn On/Off Tracking of Responses per-request</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> ResponseTrackingFilter<span class="token punctuation">;</span>
    
    <span class="token comment">// Whether to include CallStack StackTrace </span>
    <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> IncludeStackTrace<span class="token punctuation">;</span>

    <span class="token comment">// Attach custom data to request profiling summary fields</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span>IRequest<span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> TagResolver<span class="token punctuation">;</span>
    
    <span class="token comment">// Label to show for custom tag</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> TagLabel<span class="token punctuation">;</span>
    
    <span class="token comment">// The properties displayed in Profiling UI results grid</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> SummaryFields<span class="token punctuation">;</span>
    
    <span class="token comment">// Default take, if none is specified</span>
    <span class="token class-name"><span class="token keyword">int</span></span> DefaultLimit <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Customize DiagnosticEntry that gets captured</span>
    <span class="token class-name">Action<span class="token punctuation">&lt;</span>DiagnosticEntry<span class="token punctuation">,</span> DiagnosticEvent<span class="token punctuation">&gt;</span><span class="token punctuation">?</span></span> DiagnosticEntryFilter<span class="token punctuation">;</span>

    <span class="token comment">// Maximum char/byte length of string response body</span>
    <span class="token class-name"><span class="token keyword">int</span></span> MaxBodyLength <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>`,90),_=[C,x,P,S,A];function I(W,V,B,K,j,F){return L(),E("div",null,_)}var N=D(O,[["render",I]]);export{U as __pageData,N as default};
