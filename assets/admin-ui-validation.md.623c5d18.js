import{_ as s,a as t,b as e,c as o}from"./chunks/validation-category-create.a69547bf.js";import{_ as p}from"./chunks/validation-category.e0d4ea5c.js";import{_ as i,c,o as l,b as a,e as n,a as r}from"./app.c4573477.js";const R='{"title":"Admin UI Validation","description":"","frontmatter":{"title":"Admin UI Validation"},"headers":[{"level":3,"title":"Pre-populating Validation Rules","slug":"pre-populating-validation-rules"},{"level":3,"title":"Validation UI","slug":"validation-ui"},{"level":3,"title":"Verified Rules","slug":"verified-rules"}],"relativePath":"admin-ui-validation.md"}',u={},d=a("p",null,[n("The DB Validation feature leverages the existing "),a("a",{href:"/declarative-validation"},"Declarative Validation"),n(" infrastructure where it enables dynamically managing Request DTO Type and Property Validators from a RDBMS data source which immediately takes effect at runtime and can be optionally cached where they'll only need to be re-hydrated from the database after modification.")],-1),k=a("iframe",{class:"video-hd",src:"https://www.youtube.com/embed/W5OJAlOxH98",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),h=a("p",null,[n("This feature can be easily added to existing host projects with the "),a("a",{href:"/mix-tool"},"mix"),n(" command:")],-1),m=a("div",{class:"sh-copy cp flex cursor-pointer mb-3",onclick:"copy(this)"},[a("div",{class:"flex-grow bg-gray-800"},[a("div",{class:"pl-4 py-1 pb-1.5 align-middle whitespace-pre text-base text-gray-100"},[a("p",null,"x mix validation-source")])]),a("div",{class:"flex"},[a("div",{class:"bg-green-600 text-white p-1.5 pb-0"},[a("svg",{class:"copied w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),a("svg",{class:"nocopy w-6 h-6",title:"copy",fill:"none",stroke:"white",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})])])])],-1),g=r(`<p>Which will add the <a href="/modular-startup">Modular Startup</a> validation configuration to your project, utilizing your existing configured database:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">HostingStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MyApp<span class="token punctuation">.</span>ConfigureValidation</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>

<span class="token keyword">namespace</span> <span class="token namespace">MyApp</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigureValidation</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHostingStartup</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Add support for dynamically generated db rules</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IWebHostBuilder</span> builder<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> builder
        <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span> services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IValidationSource<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteValidationSource</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDbConnectionFactory<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HostContext<span class="token punctuation">.</span>LocalCache<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ConfigureAppHost</span><span class="token punctuation">(</span>appHost <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// Create \`ValidationRule\` table if it doesn&#39;t exist in AppHost.Configure() or Modular Startup</span>
            appHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IValidationSource<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which the built-in <a href="/validation.html#validation-feature">Validation Feature</a> detects before registering the <code>GetValidationRules</code> and <code>ModifyValidationRules</code> management APIs and enables the DB Validation Admin UI:</p><div class="block p-4 rounded shadow"><img src="`+s+`"></div><h3 id="pre-populating-validation-rules" tabindex="-1">Pre-populating Validation Rules <a class="header-anchor" href="#pre-populating-validation-rules" aria-hidden="true">#</a></h3><p>A minimum set of validation rules can be enforced by adding them on Startup, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> validationSource <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IValidationSource<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
validationSource<span class="token punctuation">.</span><span class="token function">InitSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
validationSource<span class="token punctuation">.</span><span class="token function">SaveValidationRules</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>ValidateRule<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidateRule</span> <span class="token punctuation">{</span> Type<span class="token operator">=</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>CreateTable<span class="token punctuation">)</span><span class="token punctuation">,</span> Validator <span class="token operator">=</span> <span class="token string">&quot;NoRefTableReferences&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidateRule</span> <span class="token punctuation">{</span> Type<span class="token operator">=</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyRequest<span class="token punctuation">)</span><span class="token punctuation">,</span> Field<span class="token operator">=</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyRequest<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">,</span> Validator <span class="token operator">=</span> <span class="token string">&quot;NotNull&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidateRule</span> <span class="token punctuation">{</span> Type<span class="token operator">=</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyRequest<span class="token punctuation">)</span><span class="token punctuation">,</span> Field<span class="token operator">=</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MyRequest<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">,</span> Validator <span class="token operator">=</span> <span class="token string">&quot;InclusiveBetween(13,100)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This can also be used to support alternative data sources by pre-populating validation rules in an <code>MemoryValidationSource</code>, although the recommendation would be to implement <a href="https://github.com/ServiceStack/ServiceStack/blob/main/ServiceStack/src/ServiceStack.Interfaces/ValidationRule.cs" target="_blank" rel="noopener noreferrer">IValidationSourceAdmin</a> to get the full features of the Admin Validation UI.</p><h3 id="validation-ui" tabindex="-1">Validation UI <a class="header-anchor" href="#validation-ui" aria-hidden="true">#</a></h3><p>We can start adding validation rules after selecting the API we want to add them to, tag groups provide a quick view popup allowing APIs to be selected with just a mouse, whilst groups with a large number of APIs can benefit from the Autocomplete textbox results filter.</p><div class="block p-4 rounded shadow"><img src="`+p+'"></div><p>The quick links help navigating between related AutoQuery APIs that allows jumping between different APIs with the same Data Model.</p><p>In the validation editor you&#39;ll be able to create <strong>Type</strong> and <strong>Property</strong> Validation Rules that either make use of an existing <strong>Validator</strong> or you can enter a custom <a href="https://sharpscript.net" target="_blank" rel="noopener noreferrer">#Script</a> expression that validates to <code>true</code>. The DB Validationo UI is smart and will list all built-in and Custom Script Methods returning <code>ITypeValidator</code> or <code>IPropertyValidator</code> that&#39;s registered in the remote instance. The pre-defined list of validators are displayed in a list of &quot;quick pick&quot; buttons that enables fast adding/editing of validation rules.</p><h3 id="verified-rules" tabindex="-1">Verified Rules <a class="header-anchor" href="#verified-rules" aria-hidden="true">#</a></h3><p>The <code>ModifyValidationRules</code> API used to save validation rules performs a number of checks to ensure any Validation rules are accurate including executing the validator to make sure it returns the appropriate validator type and checking the syntax on any <strong>Script</strong> validation rules to ensure it&#39;s valid.</p><div class="block p-4 rounded shadow"><img src="'+t+'"></div><div class="mt-4 block p-4 rounded shadow"><img src="'+e+'"></div><p>The <code>ModifyValidationRules</code> back-end API also takes care of invalidating the validation rule cache so that any saved Validators are immediately applied.</p><p>Despite being sourced from a DB, after the first access the validation rules are cached in memory where they&#39;d have similar performance profile to validators declaratively added on Request DTOs in code.</p><p>After you add your validation rules they&#39;ll be immediately enforced when calling the API, e.g. in <a href="/api-explorer">API Explorer</a> or <a href="/locode/">Locode</a>. Be mindful of what Validation Rule you&#39;re adding to which DTO, e.g. a validation rule added to <strong>CreateCategory</strong> API will <strong>only be applied</strong> when <strong>creating</strong> entities, e,g. not for full entity or partial field updates.</p><div class="mt-4 block p-4 rounded shadow"><img src="'+o+'"></div>',21),f=[d,k,h,m,g];function v(y,w,b,V,_,x){return l(),c("div",null,f)}var T=i(u,[["render",v]]);export{R as __pageData,T as default};
